
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A security-oriented tool for testing CPUs and detecting microarchitectural leaks like Spectre and Meltdown">
      
      
        <meta name="author" content="Microsoft">
      
      
        <link rel="canonical" href="https://github.com/microsoft/sca-fuzzer/intro/tutorials/03-faults/">
      
      
        <link rel="prev" href="../02-first-vuln/">
      
      
        <link rel="next" href="../04-isolation/">
      
      
      <link rel="icon" href="../../../assets/icon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>Tutorial 3 - Testing Faults - Revizor</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial-3-testing-faults-with-revizor" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Revizor" class="md-header__button md-logo" aria-label="Revizor" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Revizor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial 3 - Testing Faults
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/sca-fuzzer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/sca-fuzzer
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../start-here/" class="md-tabs__link">
        
  
    
  
  Start Here

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../structure/" class="md-tabs__link">
          
  
    
  
  Documentation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../faq/general/" class="md-tabs__link">
          
  
    
  
  FAQ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../internals/" class="md-tabs__link">
          
  
    
  
  Contribute

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Revizor" class="md-nav__button md-logo" aria-label="Revizor" data-md-component="logo">
      
  <img src="../../../assets/icon.png" alt="logo">

    </a>
    Revizor
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/sca-fuzzer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/sca-fuzzer
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../start-here/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Start Here
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation Structure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Revizor at a Glance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-primer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deep Dive into Concepts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04-tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview of Tutorials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-first-fuzz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial 1 - First Campaign
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-first-vuln/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial 2 - First Vulnerability
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Tutorial 3 - Testing Faults
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-isolation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial 4 - Testing Isolation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-extending/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial 5 - Extending Revizor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tsa-sq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extra Tutorial - Detecting TSA-SQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    How-To Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            How-To Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/ask-a-question/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ask a Question
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/choose-contract/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Choose a Contract
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/design-campaign/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Design a Campaign
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/interpret-results/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interpret Output
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/minimize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Minimize Violations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/root-cause-a-violation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Root-Cause a Violation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/use-templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use Templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../howto/use-macros/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use Macros
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Topics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/contracts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contracts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Leakage Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/trace-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trace Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/test-case-generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Case Generation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../topics/actors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actors
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ref/modes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modes of Operation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ref/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ref/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration Options
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ref/runtime-statistic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Runtime Statistics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ref/minimization-passes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Minimization Passes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ref/macros/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Macros
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ref/artifact-file-formats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artifact File Formats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ref/binary-formats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal Binary Formats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ref/registers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Registers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ref/sandbox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sandbox
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glossary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ref/papers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Academic Research
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            FAQ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/general/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General Questions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../internals/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Contribute
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Contribute
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/contributing/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guide to Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guidelines
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Guidelines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/contributing/general/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General Guidelines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/contributing/code-style/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Style
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/contributing/git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git Workflow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/code-structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Structure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/architecture/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/architecture/fuzz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Orchestration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/architecture/isa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ISA Specification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/architecture/code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Case Code Generation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/architecture/data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Case Data Generation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/architecture/exec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardware Tracing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/architecture/model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contract Tracing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/architecture/analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trace Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/architecture/mini/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Minimization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/architecture/logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model Backends
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Model Backends
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/model-backends/model-unicorn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unicorn Backend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../internals/model-backends/model-dr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DynamoRIO Backend
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="tutorial-3-testing-faults-with-revizor">Tutorial 3: Testing faults with Revizor</h1>
<p>Having detected Spectre V1, let's now apply the same methodology to find a different vulnerability class. Meltdown-style vulnerabilities exploit speculative execution around exception handling rather than branch misprediction.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This tutorial relies on the knowledge about sandboxed execution and the memory layout of the sandbox. If you haven't read about it yet, please refer to the <a href="../../../ref/sandbox/">Sandbox Reference</a> and the <a href="../../../topics/actors/">Actors and Isolation Topic Guide</a> before proceeding.</p>
</div>
<h3 id="plan-the-campaign">Plan the campaign</h3>
<p>The key difference in this campaign is the speculation source. Instead of conditional branches, we'll test page faults. Meltdown and related vulnerabilities occur when a CPU speculatively executes instructions that follow a faulting memory access, potentially leaking data from inaccessible memory regions.</p>
<p>From the practical standpoint, the key difference that we will need to configure the <a href="../../../ref/sandbox/">sandbox</a> to make it possible for the test case to trigger page faults. Namely, we will make one of the pages accessible by the test cases non-readable.</p>
<h3 id="create-the-configuration-file">Create the configuration file</h3>
<p>Our configuration for this campaign makes three important changes from the Spectre V1 setup. First, we remove <code>BASE-COND_BR</code> from the instruction categories since we already know conditional branches cause Spectre V1 violations. This focuses our testing on other speculation sources.</p>
<p>Second, we add an <code>actors</code> section with <code>data_properties</code> to configure the sandbox memory layout. Revizor's sandbox allocates each actor two 4KB memory regions: a main area with normal read-write permissions and a faulty area where we can configure special permissions. By setting <code>present: false</code> in the data properties, we mark the faulty area as non-present in the page tables. When the test case attempts to access this region, the CPU will raise a page fault, giving us the exception-based speculation source we want to test.</p>
<p>Third, we change the contract execution clause to <code>delayed-exception-handling</code>. Modern CPUs implement out-of-order execution, so data-independent instructions after a fault may execute before the exception is recognized. This is expected behavior and would cause trivial violations under the strict <code>no_speculation</code> contract. The <code>delayed-exception-handling</code> clause accommodates this expected speculation, allowing Revizor to focus on more interesting leaks. For more details on contract selection, see <a href="../../../howto/choose-contract/">How to Choose a Contract</a>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># contract</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nt">contract_observation_clause</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loads+stores+pc</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nt">contract_execution_clause</span><span class="p">:</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delayed-exception-handling</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="c1"># tested instructions</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nt">instruction_categories</span><span class="p">:</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BASE-BINARY</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">  </span><span class="c1"># - BASE-COND_BR</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nt">actors</span><span class="p">:</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">main</span><span class="p">:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">data_properties</span><span class="p">:</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">present</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="nt">enable_speculation_filter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="nt">enable_observation_filter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="nt">enable_fast_path_model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<h3 id="run-the-fuzzer">Run the fuzzer</h3>
<p>With the configuration ready, let's run the fuzzer.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>$ ./revizor.py fuzz -s base.json -c dbg/tut/2.yaml -n 1000 -i 20 -w .
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>INFO: [fuzzer] Starting at 12:05:26
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>66    ( 7%)| Stats: Cls:19/19,In:40,R:19,SF:0,OF:0,Fst:6,CN:60,CT:0,P1:0,CS:0,P2:0,V:0
</code></pre></div>
<p>Notice in the statistics that <code>SF:0,OF:0</code>â€”unlike the Spectre V1 campaign, none of our test cases are filtered by the speculation or observation filters since every test case with a page fault exhibits speculation.</p>
<p>Eventually (after a few minutes), Revizor detects a violation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>================================ Violations detected ==========================
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>Violation Details:
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>-----------------------------------------------------------------------------------
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>                             HTrace                              | ID:3   | ID:23 |
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>-----------------------------------------------------------------------------------
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>^^.^.......^.........^..^.........................^............^ | 627    | 0     |
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>^^.^...^...^............^.........................^............^ | 0      | 627   |
</code></pre></div>
<p>The output is similar to what we saw in the Spectre V1 campaign, so we won't go into the details of reading the violation report again. The key takeaway is that we've successfully detected a contract violation, and the hardware traces show different cache access patterns for the two inputs.</p>
<h3 id="validate-the-violation">Validate the violation</h3>
<p>As before, we validate the violation by reproducing it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$ ./revizor.py reproduce -s base.json -c ./violation/reproduce.yaml -t ./violation/program.asm -i ./violation/input*.bin
</code></pre></div>
<p>The output should be similar to the original:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>================================ Violations detected ==========================
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>Violation Details:
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>-----------------------------------------------------------------------------------
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>                             HTrace                              | ID:3   | ID:23 |
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>-----------------------------------------------------------------------------------
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>^^.^.......^.........^..^.........................^............^ | 627    | 0     |
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>^^.^...^...^............^.........................^............^ | 0      | 627   |
</code></pre></div>
<p>Great! The violation reproduces successfully, confirming it's genuine.</p>
<h3 id="minimize-the-test-case">Minimize the test case</h3>
<p>Now we minimize the test case to make it easier to analyze:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>./revizor.py minimize -s base.json -c ./violation/minimize.yaml -t ./violation/program.asm  -o ./violation/min.asm -i 10 --num-attempts 3 \
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    --enable-instruction-pass 1 \
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    --enable-simplification-pass 1 \
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    --enable-nop-pass 1 \
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    --enable-constant-pass 1 \
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    --enable-mask-pass 1 \
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    --enable-label-pass 1
</code></pre></div>
<p>After the minimization completes, verify that the minimized program still reproduces the violation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>./revizor.py reproduce -s base.json -c ./violation/reproduce.yaml -t ./violation/min.asm -i ./violation/input*.bin
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>INFO: [prog_gen] Setting program_generator_seed to random value: 578824
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>INFO: [fuzzer] Starting at 12:14:08
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>&gt; Entering slow path...&gt; Priming  6             &gt; Increasing sample size... to 50&gt; Increasing sample size... to 100&gt; Increasing sample size... to 500&gt; Priming  6
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>================================ Violations detected ==========================
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>Violation Details:
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>-----------------------------------------------------------------------------------
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>                             HTrace                              | ID:11  | ID:31 |
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>-----------------------------------------------------------------------------------
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>^^.^.......^...^........^.........................^...^........^ | 627    | 0     |
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>^^.^.......^...^........^.........................^............^ | 0      | 627   |
</code></pre></div>
<h3 id="identify-the-leaked-value">Identify the leaked value</h3>
<p>Next, we minimize the inputs to identify which specific values are being leaked:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>./revizor.py minimize -s base.json -c ./violation/minimize.yaml -t ./violation/min.asm -o ./violation/min.asm -i 10 --input-outdir ./violation/min-inputs \
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    --enable-input-diff-pass 1 \
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    --enable-input-seq-pass 1 \
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    --enable-comment-pass 1 \
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    --enable-instruction-pass false
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>(skipping output for brevity)
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>  &gt; Minimizing the difference between inputs 0 and 1
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>Address    +0x0     +0x40    +0x80    +0xc0    +0x100   +0x140   +0x180   +0x1c0
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>0x00000000 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>0x00000200 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>0x00000400 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>0x00000600 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>0x00000800 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>0x00000a00 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>0x00000c00 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>0x00000e00 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>0x00001000 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>0x00001200 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>0x00001400 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>0x00001600 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>0x00001800 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>0x00001a00 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>0x00001c00 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>0x00001e00 ........ ........ ........ ........ ........ ........ ........ ........
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>0x00002000 ..=.=^..
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>0x00002040 ........ ........ ........ ........
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>  &gt; Result: Leaked 1 bytes
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>  &gt; Addresses: [&#39;0x2028&#39;]
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>  &gt; Saving new inputs in &#39;/home/t-oleksenkoo/revizor/violation/min-inputs&#39;
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>  &gt; Violating input IDs: [5, 15]
</code></pre></div>
<p>Key takeaways:</p>
<ul>
<li>The leaked value originates from address <code>0x2028</code> in the input, which corresponds to offset <code>0x28</code> in the GPR initialization region of the sandbox memory, used to initialize the <code>RDI</code> register.</li>
<li>Two other values in the input were not zeroed out, which indicates they are somehow relevant to triggering the violation. Namely, those are offsets <code>0x10</code> and <code>0x20</code>, which correspond to <code>RCX</code> and <code>RSI</code>.</li>
</ul>
<h3 id="perform-root-cause-analysis">Perform root-cause analysis</h3>
<p>With the minimized program and inputs, we can now investigate the root cause. The minimized program is as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="na">.intel_syntax</span><span class="w"> </span><span class="no">noprefix</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="na">.section</span><span class="w"> </span><span class="no">.data.main</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="nl">.function_0:</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="nl">.macro.measurement_start:</span><span class="w"> </span><span class="nf">nop</span><span class="w"> </span><span class="no">qword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">0xff</span><span class="p">]</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="nf">and</span><span class="w"> </span><span class="no">rsi</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">b1111111111000</span><span class="w"> </span><span class="c1"># instrumentation</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="nf">add</span><span class="w"> </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="no">qword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rsi</span><span class="p">]</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="nf">add</span><span class="w"> </span><span class="no">cl</span><span class="p">,</span><span class="w"> </span><span class="no">dl</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="nf">and</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">b1111111111000</span><span class="w"> </span><span class="c1"># instrumentation</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="nf">add</span><span class="w"> </span><span class="no">qword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rcx</span><span class="p">],</span><span class="w"> </span><span class="no">rbx</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="nf">and</span><span class="w"> </span><span class="no">rbx</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">b1111111111000</span><span class="w"> </span><span class="c1"># instrumentation</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="nf">add</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rbx</span><span class="p">],</span><span class="w"> </span><span class="no">ecx</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="nf">and</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">b1111111111000</span><span class="w"> </span><span class="c1"># instrumentation</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="nf">cmp</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="no">ecx</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="nf">and</span><span class="w"> </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">b1111111111000</span><span class="w"> </span><span class="c1"># instrumentation</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="nf">or</span><span class="w"> </span><span class="no">byte</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rdi</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="c1"># instrumentation  # &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; HERE: RDI is used here</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="nf">mov</span><span class="w"> </span><span class="no">ax</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="c1"># instrumentation</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="nf">div</span><span class="w"> </span><span class="no">byte</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rdi</span><span class="p">]</span><span class="w">                      </span><span class="c1"># &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; HERE: RDI is used here</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="nf">and</span><span class="w"> </span><span class="no">rsi</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">b1111111111000</span><span class="w"> </span><span class="c1"># instrumentation</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="nf">sub</span><span class="w"> </span><span class="no">byte</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rsi</span><span class="p">],</span><span class="w"> </span><span class="no">bl</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="nf">and</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">b1111111111000</span><span class="w"> </span><span class="c1"># instrumentation</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="nf">sub</span><span class="w"> </span><span class="no">al</span><span class="p">,</span><span class="w"> </span><span class="no">byte</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rcx</span><span class="p">]</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a><span class="nf">and</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">b1111111111000</span><span class="w"> </span><span class="c1"># instrumentation</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="nf">mul</span><span class="w"> </span><span class="no">qword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rcx</span><span class="p">]</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="nf">and</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">b1111111000000</span><span class="w"> </span><span class="c1"># instrumentation</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="na">lock</span><span class="w"> </span><span class="nf">sub</span><span class="w"> </span><span class="no">word</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">-128</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="nl">.macro.measurement_end:</span><span class="w"> </span><span class="nf">nop</span><span class="w"> </span><span class="no">qword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">0xff</span><span class="p">]</span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="na">.section</span><span class="w"> </span><span class="no">.data.main</span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="nl">.test_case_exit:</span><span class="nf">nop</span>
</code></pre></div></td></tr></table></div>
<p>RDI is used in two places:</p>
<ol>
<li>Line 15: <code>or byte ptr [r14 + rdi], 1</code> (a write)</li>
<li>Line 17: <code>div byte ptr [r14 + rdi]</code> (a read)</li>
</ol>
<p>This is a clear data-dependent pattern, which explains why RDI is being leaked. But normally, these patterns should not be reported as violations of CT-DEH (our selected contract), since the contract permits cache-based leakage. So if the violation was reported, it means these instructions were not executed in the model. Let's investigate why.</p>
<p>We will inspect how the model executes this program. To this end, we will add a debug flag to the config file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nt">logging_modes</span><span class="p">:</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbg_model</span>
</code></pre></div>
<p>Then, we will reproduce the violation again, now with a verbose log of test case execution on the model:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>./revizor.py reproduce -s base.json -c ./violation/reproduce.yaml -t ./violation/min.asm -i ./violation/min-inputs/min_input_0000.bin
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>                     ##### Input 0 #####
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>0x0 : macro .measurement_start, .noarg
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>  rax=0x0000000000000000 rbx=0x0000000000000000 rcx=0x0000d04a0000d04a rdx=0x0000000000000000
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>  rsi=0x0000d0510000d051 rdi=0x000056b8000056b8 flags=0b000000000010
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>  xmm0=0x00000000000000000000000000000000 xmm1=0x00000000000000000000000000000000
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>  xmm2=0x00000000000000000000000000000000 xmm3=0x00000000000000000000000000000000
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>  xmm4=0x00000000000000000000000000000000 xmm5=0x00000000000000000000000000000000
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>  xmm6=0x00000000000000000000000000000000 xmm7=0x00000000000000000000000000000000
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>0x8 : and rsi, 0b1111111111000
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>  rax=0x0000000000000000 rbx=0x0000000000000000 rcx=0x0000d04a0000d04a rdx=0x0000000000000000
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>  rsi=0x0000d0510000d051 rdi=0x000056b8000056b8 flags=0b000000000010
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>  xmm0=0x00000000000000000000000000000000 xmm1=0x00000000000000000000000000000000
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>  xmm2=0x00000000000000000000000000000000 xmm3=0x00000000000000000000000000000000
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>  xmm4=0x00000000000000000000000000000000 xmm5=0x00000000000000000000000000000000
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>  xmm6=0x00000000000000000000000000000000 xmm7=0x00000000000000000000000000000000
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>0xf : add rdi, [r14 +rsi]
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>  rax=0x0000000000000000 rbx=0x0000000000000000 rcx=0x0000d04a0000d04a rdx=0x0000000000000000
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>  rsi=0x0000000000001050 rdi=0x000056b8000056b8 flags=0b000000000110
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>  xmm0=0x00000000000000000000000000000000 xmm1=0x00000000000000000000000000000000
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>  xmm2=0x00000000000000000000000000000000 xmm3=0x00000000000000000000000000000000
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>  xmm4=0x00000000000000000000000000000000 xmm5=0x00000000000000000000000000000000
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>  xmm6=0x00000000000000000000000000000000 xmm7=0x00000000000000000000000000000000
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a>    &gt; load from +0x2050 value 0x0
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a>EXCEPTION #13: Read from non-readable memory (UC_ERR_READ_PROT)
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a>0x13: [transient, nesting = 1] add cl, dl
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a>  rax=0x0000000000000000 rbx=0x0000000000000000 rcx=0x0000d04a0000d04a rdx=0x0000000000000000
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a>  rsi=0x0000000000001050 rdi=0x000056b8000056b8 flags=0b000000000110
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>  xmm0=0x00000000000000000000000000000000 xmm1=0x00000000000000000000000000000000
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a>  xmm2=0x00000000000000000000000000000000 xmm3=0x00000000000000000000000000000000
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>  xmm4=0x00000000000000000000000000000000 xmm5=0x00000000000000000000000000000000
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a>  xmm6=0x00000000000000000000000000000000 xmm7=0x00000000000000000000000000000000
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a>0x15: [transient, nesting = 1] and rcx, 0b1111111111000
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a>  rax=0x0000000000000000 rbx=0x0000000000000000 rcx=0x0000d04a0000d04a rdx=0x0000000000000000
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a>  rsi=0x0000000000001050 rdi=0x000056b8000056b8 flags=0b000000000010
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a>  xmm0=0x00000000000000000000000000000000 xmm1=0x00000000000000000000000000000000
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a>  xmm2=0x00000000000000000000000000000000 xmm3=0x00000000000000000000000000000000
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a>  xmm4=0x00000000000000000000000000000000 xmm5=0x00000000000000000000000000000000
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a>  xmm6=0x00000000000000000000000000000000 xmm7=0x00000000000000000000000000000000
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a>0x1c: [transient, nesting = 1] add [r14 +rcx], rbx
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a>  rax=0x0000000000000000 rbx=0x0000000000000000 rcx=0x0000000000001048 rdx=0x0000000000000000
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a>  rsi=0x0000000000001050 rdi=0x000056b8000056b8 flags=0b000000000110
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a>  xmm0=0x00000000000000000000000000000000 xmm1=0x00000000000000000000000000000000
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a>  xmm2=0x00000000000000000000000000000000 xmm3=0x00000000000000000000000000000000
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a>  xmm4=0x00000000000000000000000000000000 xmm5=0x00000000000000000000000000000000
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a>  xmm6=0x00000000000000000000000000000000 xmm7=0x00000000000000000000000000000000
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a>
<a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a>    &gt; load from +0x2048 value 0x0
<a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a>EXCEPTION #13: Read from non-readable memory (UC_ERR_READ_PROT)
<a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a>ROLLBACK to 0x7f
</code></pre></div>
<p>This log shows in detail which instructions from the test case were executed by the model, whether they were transient or non-transient, and the register/memory state before each instruction.</p>
<p>We can see that, early in the execution of the test case, a page fault occurs when trying to read from memory at address <code>0x2050</code>. This is because of the configuration we're using, where the second page of the sandbox memory (the faulty page) is set as non-readable.</p>
<p>Accordingly, since we're using <code>delayed-exception-handling</code> execution clause, the model will not execute any instructions that are data-dependent on this faulting load. This includes the two instructions that use RDI (lines 15 and 17), since RDI was computed based on the value loaded from address <code>0x2050</code>.</p>
<p>From this, we can conclude that the CPU implements some sort of speculation on page faults: The RDI-dependent instructions were not supposed to be executed, but we see leakage of RDI in cache traces nonetheless.</p>
<p>To understand what specific value is returned speculatively, we can manually modify the test case, and replace the instructions after the faulting load with a gadget that will specifically leak RDI:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="na">.intel_syntax</span><span class="w"> </span><span class="no">noprefix</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="na">.section</span><span class="w"> </span><span class="no">.data.main</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="nl">.macro.measurement_start:</span><span class="w"> </span><span class="nf">nop</span><span class="w"> </span><span class="no">qword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">0xff</span><span class="p">]</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="nf">and</span><span class="w"> </span><span class="no">rsi</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">b1111111111000</span><span class="w"> </span><span class="c1"># instrumentation</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="no">qword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rsi</span><span class="p">]</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="nf">and</span><span class="w"> </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">b111111111111</span><span class="w">  </span><span class="c1"># mask the value of RDI</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="no">qword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rdi</span><span class="p">]</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="nl">.macro.measurement_end:</span><span class="w"> </span><span class="nf">nop</span><span class="w"> </span><span class="no">qword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">0xff</span><span class="p">]</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="nl">.test_case_exit:</span>
</code></pre></div></td></tr></table></div>
<p>Will will also enable another debug mode to see the hardware traces even when no violation is detected:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nt">logging_modes</span><span class="p">:</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="c1"># - dbg_model</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbg_dump_htraces</span>
</code></pre></div>
<p>Then, we can run the modified test case:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>$ ./revizor.py reproduce -s base.json -c ./violation/reproduce.yaml \
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    -t ./violation/min.asm -i ./violation/min-inputs/min_input_0000.bin
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>================================ Collected Traces =============================
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>- Input 0:
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>  HTr:
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    ^^.^.......^............^.........................^............^ [10]
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>  Feedback: (816, 685, 64, 0, 0)
</code></pre></div>
<p>We see that multiple cache lines were accesses, so it is hard to pinpoint the exact one that belongs to the speculative leak. (We likely have all these evictions due to the page walk triggered by the page fault.)</p>
<p>We can identify the specific cache line by further modifying the test case to add an hard offset to the speculative memory access, e.g., changing:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="no">qword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">r14</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="no">rdi</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="mi">0x100</span><span class="p">]</span>
</code></pre></div>
<p>Then, we can run it again and see how the hardware trace changes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>./revizor.py reproduce -s base.json -c ./violation/reproduce.yaml -t ./violation/min.asm -i ./violation/min-inputs/min_input_0000.bin
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>================================ Collected Traces =============================
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>- Input 0:
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>  HTr:
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    ^^.^^......^............^.........................^............^ [10]
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>  Feedback: (816, 685, 71, 0, 0)
</code></pre></div>
<p>Let's compare it side-by-side with the previous trace:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Before: ^^.^.......^............^.........................^............^
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>After:  ^^.^^......^............^.........................^............^
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>            |
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>            + Added cache set access due to +0x100 offset
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>              (cache set ID 4)
</code></pre></div>
<p>This shows that the speculative access used cache set ID 4. From this, we can do a simple calculation to deduce the value of RDI that was used for the memory access:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>Cache ID = 4
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>Cache Line Size = 0x40
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>Hardcoded Offset = 0x100
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>Speculative Address = (Cache ID * Cache Line Size) = rdi + Hardcoded Offset // ignore r14
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>=&gt;
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>rdi_masked = (Cache ID * Cache Line Size) - Hardcoded Offset = (4 * 0x40) - 0x100 = 0x0
</code></pre></div>
<p>Now we know that the masked value of RDI used in the speculative access was <code>0x0</code>. The remaining part is to figure out what was the original value of RDI before masking. For that, we can shift the pre-mask value of RDI by 12 bits (since the mask is <code>0b111111111111</code> = 0xfff = 12 bits) and repeat the procedure. We'll do 6 times to reveal the whole value.</p>
<p>The resulting traces are as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>no shift: ^^.^.......^............^.........................^............^
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>12 bits:  ^^.^.......^............^.........................^............^
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>24 bits:  ^^.^.......^............^.........................^............^
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>36 bits:  ^^.^.......^............^.........................^............^
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>48 bits:  ^^.^.......^............^.........................^............^
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>60 bits:  ^^.^.......^............^.........................^............^
</code></pre></div>
<p>We can see that in all cases, the cache set accessed is 0, which means that the masked value of RDI was always 0, regardless of how much we shifted it.</p>
<p>This tells us that the faulting load returned 0 speculatively, which reveals to us the root cause of the violation. This is an instance of a previously-discovered vulnerability called LVI-Null, which we have successfully and independently rediscovered using Revizor!</p>
<div class="admonition success">
<p class="admonition-title">What We've Learned</p>
<p>In this section, we applied the same systematic workflow to a different vulnerability class:</p>
<ul>
<li><strong>Flexible configuration</strong>: By changing just a few configuration options (removing branches, adding page faults, adjusting the contract), we refocused our search entirely</li>
<li><strong>Contract selection matters</strong>: The <code>delayed-exception-handling</code> contract helped filter out trivial violations while exposing genuine leaks</li>
<li><strong>Deep analysis techniques</strong>: We manually modified test cases and used offset manipulation to precisely identify what value the CPU returned speculatively</li>
</ul>
<p>The same workflowâ€”plan, configure, fuzz, validate, minimize, analyzeâ€”works across all speculative execution vulnerability classes.</p>
</div>
<h3 id="whats-next">What's Next?</h3>
<p>Proceed to <a href="../04-isolation/">Tutorial 4</a> to see how we can go even further and start testing high-level isolation properties.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Microsoft
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.indexes", "navigation.tabs", "toc.integrate", "search.suggest", "search.highlight"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>