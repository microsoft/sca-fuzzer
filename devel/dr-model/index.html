
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A security-oriented tool for testing CPUs and detecting microarchitectural leaks like Spectre and Meltdown">
      
      
        <meta name="author" content="Microsoft">
      
      
        <link rel="canonical" href="https://github.com/microsoft/sca-fuzzer/devel/dr-model/">
      
      
        <link rel="prev" href="../macros/">
      
      
        <link rel="next" href="../binary-formats/">
      
      
      <link rel="icon" href="../../assets/ms_icon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>DynamoRIO backend - Revizor</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dynamorio-based-model-backend" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Revizor" class="md-header__button md-logo" aria-label="Revizor" data-md-component="logo">
      
  <img src="../../assets/ms_icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Revizor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DynamoRIO backend
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/sca-fuzzer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/sca-fuzzer
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../quick-start/" class="md-tabs__link">
        
  
    
  
  Quick Start

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../contracts/" class="md-tabs__link">
        
  
    
  
  Theoretical Foundations

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../user/cli/" class="md-tabs__link">
          
  
  User Documentation

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../overview/" class="md-tabs__link">
          
  
  Developer Documentation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/fuzzing-campaign/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Revizor" class="md-nav__button md-logo" aria-label="Revizor" data-md-component="logo">
      
  <img src="../../assets/ms_icon.png" alt="logo">

    </a>
    Revizor
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/sca-fuzzer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/sca-fuzzer
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contracts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Theoretical Foundations
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            User Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/modes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modes of Operation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration Options
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/minimization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Minimization Passes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/actors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/macros/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Macros
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Developer Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Developer Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development Guidelines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" checked>
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced Topics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../registers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Register Allocation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sandbox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Case Sandbox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../macros/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Macros
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    DynamoRIO backend
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    DynamoRIO backend
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Design Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      Python Adapter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-case-loader" class="md-nav__link">
    <span class="md-ellipsis">
      Test Case Loader
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamorio-tool" class="md-nav__link">
    <span class="md-ellipsis">
      DynamoRIO Tool
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DynamoRIO Tool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instrumentation-components" class="md-nav__link">
    <span class="md-ellipsis">
      Instrumentation Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-time-components" class="md-nav__link">
    <span class="md-ellipsis">
      Execution-Time Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standalone-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Standalone Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Standalone Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../binary-formats/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binary Formats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code-generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Case Code Generation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/fuzzing-campaign/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Designing a Revizor Fuzzing Campaign
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/root-causing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Root-Causing a Violation Detected by Revizor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/tsa-sq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Detecting TSA-SQ with Revizor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Design Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      Python Adapter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-case-loader" class="md-nav__link">
    <span class="md-ellipsis">
      Test Case Loader
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamorio-tool" class="md-nav__link">
    <span class="md-ellipsis">
      DynamoRIO Tool
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DynamoRIO Tool">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instrumentation-components" class="md-nav__link">
    <span class="md-ellipsis">
      Instrumentation Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-time-components" class="md-nav__link">
    <span class="md-ellipsis">
      Execution-Time Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#standalone-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Standalone Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Standalone Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="dynamorio-based-model-backend">DynamoRIO-based Model Backend</h1>
<p>This document describes the DynamoRIO-based model.
As any other model, this backend is responsible for collecting contract traces for generated test cases.</p>
<h2 id="design-overview">Design Overview</h2>
<p>This backend is composed of several parts:</p>
<ul>
<li>The Python adapter (<code>rvzr/model_dynamorio/model.py</code>) is responsible for receiving a test case from Revizor, transforming it into a format that can be executed by the backend, triggering the backend to execute the test case, and returning the collected contract traces to Revizor.</li>
<li>The Test Case Loader (<code>rvzr/model_dynamorio/adapter.c</code>) is a C program that loads a test case program and a batch of inputs into its memory, and executes the test case program with each input in a sequence.</li>
<li>The DynamoRIO components (<code>rvzr/model_dynamorio/backend</code>) are executed together with the test case loader, and they instrument the loader binary to collect contract traces.</li>
</ul>
<p>These components can be roughly divided into the instrumentation-time components that are responsible for modifying the binary, and execution-time components that implement the model logic (i.e., the contract).</p>
<p><a href="../../assets/dr-model.png"><img alt="DynamoRIO-based Model Backend" src="../../assets/dr-model.png" /></a></p>
<h2 id="python-adapter">Python Adapter</h2>
<p>Revizor communicates with the backend through a Python adapter (<code>rvzr/model_dynamorio/model.py:DynamoRIOModel</code>).</p>
<p>At the beginning of the fuzzing process, Revizor configures the backend by calling <code>configure_clauses</code> method.
This configuration will be later passed down to the backend when the test case is executed.</p>
<p>During the fuzzing process, Revizor sends test cases to the backend by calling <code>load_test_case</code> method, and then triggers the backend to execute the test case by calling <code>trace_test_case</code> method.
Internally, <code>trace_test_case</code> will call the backend to execute the test case and collect the contract traces.
The adapter will then parse the traces and return them back to the caller.</p>
<p>The <code>trace_test_case</code> method implements the following algorithm:</p>
<ul>
<li>Convert test case program and inputs into RCBF and RDBF files, respectively</li>
<li>For each input, call the test case loader with the RCBF and RDBF files. Attach the DynamoRIO backend to the call so that the binary instrumentation is performed:
<div class="highlight"><pre><span></span><code>~/.local/dynamorio/drrun<span class="w"> </span>-c<span class="w"> </span>~/.local/dynamorio/libdr_model.so<span class="w"> </span>--tracer<span class="w"> </span>&lt;observation-clause&gt;<span class="w"> </span>--<span class="w"> </span>~/.local/dynamorio/adapter<span class="w"> </span>&lt;rcbf&gt;<span class="w"> </span>&lt;rdbf&gt;
</code></pre></div></li>
<li>Parse contract traces from the backend and convert them into <code>CTrace</code> objects</li>
<li>Return the list of collected <code>CTrace</code> objects to the caller (usually, <code>fuzzer.py</code>)</li>
</ul>
<h2 id="test-case-loader">Test Case Loader</h2>
<p>Since the test cases produced by Revizor are raw binaries, they cannot be directly executed (e.g., they don't have <code>libc</code> linked).
The test case loader (<code>rvzr/model_dynamorio/adapter.c</code>) is a simple C program that fixes this issue by providing a wrapper around the test case binary.</p>
<p>The loader implements the following algorithm:</p>
<ul>
<li>Receive the test case binary and an input from the Python adapter via CLI arguments</li>
<li>Load the test case binary and the input into dedicated memory regions</li>
<li>Print the addresses of the test case and input memory regions (for trace normalization)</li>
<li>Initialize registers based on the input</li>
<li>Jump to the test case binary entry point</li>
<li>Return</li>
</ul>
<h2 id="dynamorio-tool">DynamoRIO Tool</h2>
<p>The DynamoRIO tool (<code>rvzr/model_dynamorio/backend</code>) is responsible for instrumenting the test case loader binary and collecting contract traces.</p>
<h3 id="implementation-overview">Implementation Overview</h3>
<p>All instrumentation logic is implemented as a DynamoRIO client. In particular,
<code>model.cpp</code> contains the event callbacks that are executed at instrumentation time,
while <code>dispatcher.cpp</code> contains the body of the callbacks that are inserted
by the DR client and are executed before every instruction at runtime. Finally, the <code>Dispatcher</code> object holds the state that is
shared between instrumentation-time callbacks and execution-time callbacks.</p>
<p>The following figure provides an overview of the implementation.</p>
<p><a href="../../assets/dr-instrumentation.png"><img alt="DynamoRIO Instrumentation Overview" src="../../assets/dr-instrumentation.png" /></a></p>
<ol>
<li><code>dr_client_main()</code> is responsible of installing the initial instrumentation callbacks to hook all relevant DR events (<code>module_load</code>, <code>bb_translation</code>, exceptions and the <code>exit</code> event)</li>
<li><code>dr_client_main()</code> also sets the name of the function to instrument (passed by <code>cli.cpp</code>)</li>
<li>on <code>module_load</code>, the instrumentation checks for the presence of the target function in the loaded module. If found, the callback adds a <code>drwarp</code> callback (<code>event_instrumentation_start</code>) which will be executed at the start of the target function</li>
<li>once a call to the target function is found, the <code>event_instrumentation_start</code> will save the return address in a global object (<code>instrumented_func</code>) and call <code>start()</code> on the dispatcher</li>
<li>from that moment on, every translated basic block is instrumented by our client, in particular:<ul>
<li>a <code>dispatch_callback()</code> is inserted before every instruction</li>
<li>at the function exit point (i.e. the previously saved return addres) an <code>exit_callback</code> is inserted</li>
</ul>
</li>
<li>these callbacks are executed at runtime with the following effects:<ul>
<li>the <code>dispatch_callback()</code> implements the observation and execution clauses (see next section)</li>
<li>the <code>exit_callback()</code> checks the current speculation state before exiting:<ul>
<li>speculative exits cause a rollback</li>
<li>architectural exit causes the instrumentation to stop</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>Finally, exceptions and the <code>exit</code> event are also forwarded to the Dispatcher:</p>
<ul>
<li>Speculative <strong>exceptions</strong> will cause a rollback, while architectural ones are forwarded to the target program</li>
<li>The <strong>exit</strong> event stops instrumentation and flushes all logs (in case the exit callback has not been executed architecturally)</li>
</ul>
<h3 id="instrumentation-components">Instrumentation Components</h3>
<p>The instrumentation components modify the binary of the test case loader by adding a call to the function <code>dispatch_callback</code> before every instruction in the binary (or more specifically, every instruction in the <code>test_case_entry</code> function of the loader).</p>
<p>The tool interacts with DynamoRIO through the <code>model.cpp</code> module.
This module registers an event for entering the <code>test_case_entry</code>, which triggers the flush of the internal DynamoRIO code fragment cache and the start of instrumentation.
The module also registers an event for every instruction in the <code>test_case_entry</code>, and the event in turn calls the <code>Dispatch::instrument_instruction()</code>. Finally, exceptions are hooked and passed to the dispatcher through <code>Dispatch::handle_exception()</code>, which can decide to either handle the signal (e.g. on speculative paths) or forward it to the test case (e.g. architectural exceptions).</p>
<p>The <code>Dispatch</code> class implements the actual instrumentation logic.
When the <code>instrument_instruction()</code> method is called, it inserts a clean call to the <code>dispatch_callback</code> function before the instruction.
The call receives the PC and opcode of the instruction as arguments.
DynamoRIO also automatically saves the complete register state before the call, thus making it available to <code>dispatch_callback</code>.</p>
<h3 id="execution-time-components">Execution-Time Components</h3>
<p>The execution-time components are responsible for implementing the contract logic, and are triggered by the <code>dispatch_callback</code> function.
At the current state of the backend, the dispatch callback invokes only two classes, Tracer and Speculator, that implement the observation and execution clauses, respectively. Optionally, each component can log additional events, e.g.
speculation rollbacks or the current register state, through a shared <code>Logger</code> component.</p>
<p>Subclasses of <code>TracerABC</code> record contract-relevant information via <code>observe_instruction</code> and <code>observe_mem_access</code> methods.
E.g., <code>TracerCT</code> implements <code>CT</code> observation clause by recording the PC of instructions upon <code>observe_instruction</code> and the address of memory accesses upon <code>observe_mem_access</code>. Currently, <code>observe_exception</code> simply adds a special entry to the trace to indicate that the program ended due to an (architectural) exception.</p>
<p>Subclasses of <code>SpeculatorABC</code> implement the contract speculation logic.
E.g., <code>SpeculatorCond</code> implements <code>speculate_instruction</code>.
When this method is called with a branch instruction, the class takes a checkpoint of the process state, flips the branch condition (i.e., modified <code>FLAGS</code> register), and continues the execution.
During the simulated speculation, each call to <code>speculate_instruction</code> counts the number of executed instructions, and when the number reaches the limit (e.g., 256), the class restores the checkpoint and continues the execution from the original state. (Actually, the algorithm is more complex, but this is the general idea.)</p>
<p>When the instrumentation ends (according to <code>model.cpp</code>), the tracer's <code>tracing_finalized</code> method is called, during which any remaining traces are flushed into the trace file, together with an "End Of Trace" entry.
The Python adapter will then read the trace file, decode it, and return the corresponding CTrace to Revizor.</p>
<h3 id="standalone-usage">Standalone Usage</h3>
<p>The DR tool can be used as a standalone tool to collect the runtime trace of any program, independently from the rest of Revizor's infrastructure.</p>
<p>A typical usage is for example:</p>
<div class="highlight"><pre><span></span><code>~/.local/dynamorio/drrun<span class="w"> </span>-c<span class="w"> </span>~/.local/dynamorio/libdr_model.so<span class="w"> </span>--tracer<span class="w"> </span>&lt;observation-clause&gt;<span class="w"> </span>--speculator<span class="w"> </span>&lt;speculation-clause&gt;<span class="w"> </span>--<span class="w"> </span>ls<span class="w"> </span>/dev/null
</code></pre></div>
<p>By default, this will instrument <code>ls</code> starting from <code>__libc_start_main</code> until the end of the program, run it with <code>/dev/null</code> as an argument, and generate a binary file called <code>rvzr_trace.dat</code> that contains the collected trace. Other flags can be printed using <code>~/.local/dynamorio/drrun -c ~/.local/dynamorio/libdr_model.so -h</code></p>
<p>The trace file location can be changed by adding <code>--trace-output &lt;PATH&gt;</code>. Additionally, the tool can also dump the trace in human-readable format to STDOUT using the <code>--print-trace</code> flag.</p>
<p>To decode and analyze the trace file, downstream tools should always use the <code>TraceDecoder</code> class provided by <code>trace_decoder.py</code>. For internal usage, this module also provides a simple entrypoint for trace printing:</p>
<div class="highlight"><pre><span></span><code>python3<span class="w"> </span>trace_decoder.py<span class="w"> </span>rzvr_trace.dat
</code></pre></div>
<h4 id="debugging">Debugging</h4>
<p>Attaching a debugger like GDB to the DR tool might not always be the best debugging option, as the program has three separate states:</p>
<ol>
<li>the state of the program being instrumented (e.g. <code>ls</code>)</li>
<li>the state of the DR client (<code>libdr_model.so</code>) instrumentation</li>
<li>the state of DynamoRIO itself (<code>drrun</code>)</li>
</ol>
<p>More information about debugging DR clients can be found <a href="https://dynamorio.org/page_debugging.html">here</a>.</p>
<p>For our instrumentation, other (possibly simpler) options are available:</p>
<ol>
<li><strong>Inspecting Debug Traces</strong>: the DR tool can optionally log extra information, e.g. the complete state of the register file before each instruction, each value being read and written to memory, and speculation events like checkpoints are rollbacks, in a separate debug trace:<ul>
<li>This option can be enabled using <code>--log-level &lt;N&gt;</code></li>
<li>By default, the tool will dump debug entries to <code>rzvr_dbg_trace.dat</code> in binary format; to change the path of the debug trace file use <code>--debug-output &lt;PATH&gt;</code></li>
<li><code>--print-debug-trace</code> can be used to pretty-print debug entries to STDOUT during execution</li>
<li><code>trace_decoder.py</code> also provides a decoder for debug entries</li>
<li><strong>WARNING:</strong> debug traces can become very big, especially for nested speculation</li>
</ul>
</li>
<li><strong>Running DynamoRIO with logging</strong>: DynamoRIO can also produce logs (see DR documentation):</li>
</ol>
<div class="highlight"><pre><span></span><code>~/.local/dynamorio/drrun -debug -loglevel 3 -c ~/.local/dynamorio/libdr_model.so --tracer &lt;observation-clause&gt; --speculator &lt;speculation-clause&gt; -- ls /dev/null
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Microsoft
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "search.share"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>