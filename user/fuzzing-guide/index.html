
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A security-oriented tool for detecting microarchitectural leaks in CPUs, such as Spectre and Meltdown.">
      
      
        <meta name="author" content="Microsoft">
      
      
        <link rel="canonical" href="https://github.com/microsoft/sca-fuzzer/user/fuzzing-guide/">
      
      
        <link rel="prev" href="../minimization/">
      
      
        <link rel="next" href="../../development/">
      
      
      <link rel="icon" href="../../assets/ms_icon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.30">
    
    
      
        <title>Violation Root-Causing - Revizor</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial-root-causing-a-violation-detected-by-revizor" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Revizor" class="md-header__button md-logo" aria-label="Revizor" data-md-component="logo">
      
  <img src="../../assets/ms_icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Revizor
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Violation Root-Causing
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/sca-fuzzer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/sca-fuzzer
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../quick-start/" class="md-tabs__link">
        
  
    
  
  Quick Start

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../cli/" class="md-tabs__link">
          
  
  User Documentation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../development/" class="md-tabs__link">
          
  
  Developer Documentation

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Revizor" class="md-nav__button md-logo" aria-label="Revizor" data-md-component="logo">
      
  <img src="../../assets/ms_icon.png" alt="logo">

    </a>
    Revizor
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/sca-fuzzer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/sca-fuzzer
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    User Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Command Line Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modes of Operation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration Options
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../minimization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Minimization Passes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Violation Root-Causing
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Violation Root-Causing
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-locate-the-violation-files" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Locate the Violation Files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-reproduce-the-violation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Reproduce the Violation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2a-analyze-reproduction-output" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2a: Analyze Reproduction Output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2a: Analyze Reproduction Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insights-from-the-output" class="md-nav__link">
    <span class="md-ellipsis">
      Insights from the Output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-minimize-the-program" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Minimize the Program
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Minimize the Program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation-of-passes" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation of Passes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-minimization" class="md-nav__link">
    <span class="md-ellipsis">
      Verify Minimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-minimize-inputs" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Minimize Inputs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Minimize Inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insights-from-the-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Insights from the Summary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-minimization_1" class="md-nav__link">
    <span class="md-ellipsis">
      Verify Minimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-insert-speculation-fences" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Insert Speculation Fences
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-map-hardware-traces-to-minimized-program-and-data" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6: Map Hardware Traces to Minimized Program and Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-modify-the-program" class="md-nav__link">
    <span class="md-ellipsis">
      Step 7: Modify the Program
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Resources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Developer Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developer Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-revizor-works/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How Revizor Works
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Executor-related Topics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Executor-related Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../registers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Register Allocation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sandbox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Memory Layout
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-1-locate-the-violation-files" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Locate the Violation Files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-reproduce-the-violation" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Reproduce the Violation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2a-analyze-reproduction-output" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2a: Analyze Reproduction Output
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 2a: Analyze Reproduction Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insights-from-the-output" class="md-nav__link">
    <span class="md-ellipsis">
      Insights from the Output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-minimize-the-program" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Minimize the Program
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Minimize the Program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation-of-passes" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation of Passes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-minimization" class="md-nav__link">
    <span class="md-ellipsis">
      Verify Minimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-minimize-inputs" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Minimize Inputs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step 4: Minimize Inputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insights-from-the-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Insights from the Summary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-minimization_1" class="md-nav__link">
    <span class="md-ellipsis">
      Verify Minimization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-insert-speculation-fences" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Insert Speculation Fences
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-map-hardware-traces-to-minimized-program-and-data" class="md-nav__link">
    <span class="md-ellipsis">
      Step 6: Map Hardware Traces to Minimized Program and Data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-modify-the-program" class="md-nav__link">
    <span class="md-ellipsis">
      Step 7: Modify the Program
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Additional Resources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="tutorial-root-causing-a-violation-detected-by-revizor">Tutorial: Root-Causing a Violation Detected by Revizor</h1>
<p>This tutorial walks you through analysis of a contract violation detected by Revizor. The goal is to simplify the violation artifacts (program and inputs) and identify the root cause of the violation. The tutorial includes practical examples, explanations of commands, and interpretation of outputs.</p>
<p>The examples below will show the process of root-causing a violation of the CT-SEQ contract on an x86-64 CPU. The same general procedure can be applied to other contracts and architectures.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li><strong>Revizor Installed</strong>: Ensure Revizor is installed and functional.</li>
<li><strong>Detected Violation</strong>: Revizor has already surfaced a violation and stored it in a <code>violation-&lt;timestamp&gt;</code> directory.</li>
<li><strong>Configuration Files</strong>: You have access to the configuration file (<code>config.yaml</code>) used in the fuzzing campaign.</li>
</ol>
<hr />
<h2 id="step-1-locate-the-violation-files">Step 1: Locate the Violation Files</h2>
<p>When Revizor detects a violation, it creates a directory (<code>violation-&lt;timestamp&gt;</code>) containing:
- <strong><code>program.asm</code></strong>: The test case program that caused the violation.
- <strong><code>input_*.bin</code></strong>: A sequence of inputs that triggered the violation.
- <strong><code>report.txt</code></strong>: Additional details about the violation, including hardware and contract traces.
- <strong><code>org-config.yaml</code></strong>: The original configuration file used in the fuzzing campaign.
- <strong><code>reproduce.yaml</code></strong>: A configuration file for reproducing the violation.
- <strong><code>minimize.yaml</code></strong>: A configuration file for minimizing the test case.</p>
<hr />
<h2 id="step-2-reproduce-the-violation">Step 2: Reproduce the Violation</h2>
<p>To confirm the violation and analyze its context, reproduce it using the following command:</p>
<div class="highlight"><pre><span></span><code>rvzr<span class="w"> </span>reproduce<span class="w"> </span>-s<span class="w"> </span>base.json<span class="w"> </span>-c<span class="w"> </span>./violation-&lt;timestamp&gt;/reproduce.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-t<span class="w"> </span>./violation-&lt;timestamp&gt;/program.asm<span class="w"> </span>-i<span class="w"> </span>./violation-&lt;timestamp&gt;/input_*.bin
</code></pre></div>
<p>If the violation is reproducible, Revizor will print "Violation detected" in the terminal output.
The distribution of hardware traces in the reproduced violation should be roughly similar to the original violation. If the traces are significantly different, this might be a sign of a bug or a misconfiguration in the fuzzer.</p>
<blockquote>
<p><strong>Note</strong>: The cases of non-reproducible violations are expected to be rare, no more than one or two per machine/week of fuzzing. If your fuzzing campaign produces more, consider adjusting the configuration file to increase noise tolerance (see the <a href="https://microsoft.github.io/sca-fuzzer/user/config/">Configuration File Documentation</a>).</p>
</blockquote>
<h2 id="step-2a-analyze-reproduction-output">Step 2a: Analyze Reproduction Output</h2>
<p>The output of the reproduction command provides valuable insights into the violation. Here is an example output:</p>
<div class="highlight"><pre><span></span><code>================================ Violations detected ==========================
Contract trace:
 14907365725669422044 (hash)
Hardware traces:
  Input group 1: [1, 21]
  Input group 2: [11]
  ^.^....^.....^.................^...^............^............... [500    | 10    ]
  ^.^....^.....^................^^...^............^............... [0      | 490   ]

================================ Statistics ===================================
Test Cases: 1
Inputs per test case: 30.0
Violations: 1
Effectiveness:
  Total Cls: 30.0
  Effective Cls: 30.0
Discarded Test Cases:
  Speculation Filter: 0
  Observation Filter: 0
  Fast Path: 0
  Max Nesting Check: 0
  Tainting Check: 0
  Early Priming Check: 0
  Large Sample Check: 0
  Priming Check: 0

Duration: 8.2
Finished at 12:00:05
</code></pre></div>
<h3 id="insights-from-the-output">Insights from the Output</h3>
<ul>
<li><strong>Violation detected</strong>: Indicates that the violation was successfully reproduced.</li>
<li><strong>Contract Trace</strong>: The value (<code>14907365725669422044</code>) summarizes the contract trace for the inputs that triggered the violation.
This value is a hash so it does not provide direct information about the contract trace, but it should match the value from the original violation.
If you would like to see the complete contract trace, enable <code>dbg_dump_ctraces</code> in the configuration file.</li>
<li><strong>Hardware Traces</strong>: The text under the <code>Hardware traces</code> section summarizes the hardware traces that constitute the violation.</li>
<li>The text starting with <code>Input group</code> tells us that the violation was triggered by inputs #1, #11, and #21. The inputs #1 and #21 produced the same (or very similar) hardware traces, while input #11 produced a different set of traces - hence they are put into two different groups.</li>
<li>The line with <code>^</code> and <code>.</code> characters represents the observed cache changes. Each character encodes the state of the corresponding L1D cache line after the test case has been executed with the given input. Character <code>^</code> indicates that the cache line was accessed (e.g., evicted if P+P mode is used), while <code>.</code> indicates that the cache line was not accessed. The cache sets are numbered left-to-right, starting from zero (TIP: set <code>color: true</code> in config file to improve readability). So, in the above example, the first hardware trace shows the accessed cache sets were 0, 2, 7, 13, 31, 35, and 49:
<div class="highlight"><pre><span></span><code>      Set 2 accessed
      |         Set 13 accessed
      |          |                    Set 35 accessed
      |          |                     |
    ^.^....^.....^.................^...^............^...............
    |      |                       |                |
    |      |                       |                Set 49 accessed
    |      |                       Set 31 accessed
    |      Set 7 accessed
    Set 0 accessed
</code></pre></div></li>
<li>The numbers at the end of the line (<code>[500    | 10    ]</code>) are the numbers of occurrences of the given hardware trace in the sample. Recall that the executor collects each hardware trace multiple times to deal with non-determinism and to filter noise (see <code>executor_sample_sizes</code> <a href="https://microsoft.github.io/sca-fuzzer/user/config/">configuration option</a>). The first number is the number of occurrences of the trace in the first input group (i.e., inputs #1 and #21), and the second number is the number of occurrences in the second input group (input #11). So, we can tell that the first input group always produced the same hardware trace, while the second input group mainly produced the second hardware trace, but there were a few (10) occurrences of the first trace as well.</li>
<li><strong>Statistics</strong>: The statistics section can be largely ignored when root-causing the violation. Is it only useful for fine-tuning the fuzzing campaign.</li>
</ul>
<hr />
<h2 id="step-3-minimize-the-program">Step 3: Minimize the Program</h2>
<p>The violation program (<code>program.asm</code>) is a large, randomly generated sequence of instructions and it often contains many unnecessary instructions.</p>
<blockquote>
<p>TIP: If the violation is stable and reproducible, you can try to reduce the sample size to speed up the minimization process. To do so, modify the <code>executor_sample_sizes</code> parameter in the configuration file.</p>
</blockquote>
<p>Use minimization passes to simplify the program while preserving the violation:</p>
<div class="highlight"><pre><span></span><code>rvzr<span class="w"> </span>minimize<span class="w"> </span>-s<span class="w"> </span>base.json<span class="w"> </span>-c<span class="w"> </span>./violation-&lt;timestamp&gt;/minimize.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-t<span class="w"> </span>./violation-&lt;timestamp&gt;/program.asm<span class="w"> </span>-o<span class="w"> </span>minimized.asm<span class="w"> </span>-i<span class="w"> </span>&lt;num_inputs&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num-attempts<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--enable-instruction-pass<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--enable-simplification-pass<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--enable-label-pass<span class="w"> </span><span class="m">1</span>
</code></pre></div>
<h3 id="explanation-of-passes">Explanation of Passes</h3>
<ul>
<li>The default pass (no flag required) removes unnecessary instructions.</li>
<li><code>--enable-simplification-pass</code> replaces complex instructions with simpler ones.</li>
<li><code>--enable-label-pass</code> cleans up unused labels.</li>
<li>The sequence of three passes is executed 10 time (<code>--num-attempts 10</code>) to ensure the best possible simplification.</li>
</ul>
<p>This example is the simplest form of minimization. For more advanced minimization options, consider adding the flags described in the <a href="https://microsoft.github.io/sca-fuzzer/user/minimization/">Minimization Passes Documentation</a>.</p>
<h3 id="verify-minimization">Verify Minimization</h3>
<p>The <code>minimized.asm</code> file contains a reduced version of the original program that still reproduces the violation.
Run the <code>reproduce</code> command to ensure the minimizer did not introduce non-determinism.
<div class="highlight"><pre><span></span><code>rvzr<span class="w"> </span>reproduce<span class="w"> </span>-s<span class="w"> </span>base.json<span class="w"> </span>-c<span class="w"> </span>./violation-&lt;timestamp&gt;/minimize.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-t<span class="w"> </span>minimized.asm<span class="w"> </span>-i<span class="w"> </span>&lt;num_inputs&gt;
</code></pre></div></p>
<p>If the violation is <em>not</em> reproducible, try re-running the minimizer without some some of the passes or decrease the number of attempts.</p>
<hr />
<h2 id="step-4-minimize-inputs">Step 4: Minimize Inputs</h2>
<p>A test case input is the data used to initialize memory and register before executing the test case program.
Hence, if we minimize the inputs that trigger the violation, we can isolate the exact conditions causing the violation and the data that leaks.</p>
<p>Run the following command to minimize the inputs:
<div class="highlight"><pre><span></span><code>rvzr<span class="w"> </span>minimize<span class="w"> </span>-s<span class="w"> </span>base.json<span class="w"> </span>-c<span class="w"> </span>./violation-&lt;timestamp&gt;/minimize.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-t<span class="w"> </span>minimized.asm<span class="w"> </span>-o<span class="w"> </span>commented.asm<span class="w"> </span>-i<span class="w"> </span>&lt;num_inputs&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--input-outdir<span class="w"> </span>./inputs<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--enable-input-diff-pass<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--enable-comment-pass<span class="w"> </span><span class="m">1</span>
</code></pre></div></p>
<p><strong>Result</strong>:
- <strong><code>./inputs/min_input_*.bin</code></strong>: Minimized input sequence that still trigger the violation.
- A printed summary of <strong>Leaked bytes</strong> in the terminal output. Be sure to record these for further analysis.</p>
<h3 id="insights-from-the-summary">Insights from the Summary</h3>
<p>Below is an example of the printed summary from the differential input minimizer:
<div class="highlight"><pre><span></span><code>[PASS 2] Differential Input Minimizer
  &gt; Minimizing the difference between inputs 1 and 11

Address    +0x0     +0x40    +0x80    +0xc0    +0x100   +0x140   +0x180   +0x1c0
0x00000000 ........ ........ ........ ........ ........ ........ ........ ........
0x00000200 ........ =....... ........ ........ ........ ........ ........ ........
0x00000400 ........ ........ ........ ........ ........ ........ ........ ........
0x00000600 ........ ........ ........ ........ ........ ........ ........ ........
0x00000800 ........ ........ ........ ........ ........ ........ ........ ........
0x00000a00 ........ ........ ........ ........ ........ ........ ........ ........
0x00000c00 ........ ........ ........ ........ ........ ........ ........ ........
0x00000e00 ........ ........ ........ ........ ........ ........ ........ ........
0x00001000 ........ ........ ........ ........ ........ ........ ........ ........
0x00001200 ........ ........ ........ ........ ........ ........ ........ ........
0x00001400 ........ ........ ........ ........ ........ ........ ........ ........
0x00001600 ........ ........ ........ ........ ........ ........ ........ ........
0x00001800 ........ ........ ........ ........ ........ ........ ........ ........
0x00001a00 ........ ........ ........ ........ ........ ........ ........ ........
0x00001c00 ........ ........ ........ ........ ........ ........ ........ ........
0x00001e00 ........ ........ ........ ........ ........ ........ ........ ........
0x00002000 .....^..
0x00002040 ........ ........ ........ ........
  &gt; Result: Leaked 1 bytes
  &gt; Addresses: [&#39;0x2028&#39;]
</code></pre></div></p>
<p>The minimizer goes through the pair of inputs that trigger the violation - inputs #1 and #11 in this case - and tries to minimize the differences between them:
* If both inputs already have identical values at a given address, the minimizer prints <code>=</code> for that address. In this example, this is the case for address <code>0x240</code>.
* Next, the pass attempts to zero out one byte at a time in both inputs. If the violation persists, then the minimizer prints <code>.</code> for that address. In this example, most of the addresses are zeroed out.
* Next, the pass attempts to copy one byte from input #1 into the same address in input #11. If the violation persists, then the minimizer prints <code>+</code> for that address. This example does not have such cases.
* If both attempts fail, the pass restores the original values at the given address, prints <code>^</code>, and moves to the next address. In this example, the minimizer restored the original value at address <code>0x2028</code>.</p>
<p>The interpretation of these results is case-specific, but generally, the values with <code>+</code> or <code>=</code> are those that create conditions for leakage, and the values with <code>^</code> are the addresses whose value leaks.</p>
<p>In this example, the minimizer found that this test case leaks one byte at address <code>0x2028</code> (used to initialize RDI). The minimizer also found that the address <code>0x240</code> must contain specific non-zero values that must be the same in both inputs. This address in the input is used to initialize the corresponding offset in the sandbox of actor 0. See <a href="https://microsoft.github.io/sca-fuzzer/user/sandbox/">Sandbox Memory Layout</a> for more details about register and memory initialization.</p>
<blockquote>
<p>TIP 1: The <code>--enable-comment-pass 1</code> flag adds comments to the minimized input files, which can help you understand which instructions used which addresses.</p>
<p>TIP 2: Ideally, the minimizer should be able to reduce the leakage to a single byte. If more then a couple bytes leak, it typically indicates that the violation is non-deterministic, and it might be a good idea to re-run the program minimizer or to change the configuration to increase the number of attempts/increase the noise threshold. If <em>no</em> bytes leak, this is a certain sign that something went wrong; re-run the minimizer.</p>
</blockquote>
<h3 id="verify-minimization_1">Verify Minimization</h3>
<p>Run the minimized program with the reduced inputs to ensure the violation is still reproducible:
<div class="highlight"><pre><span></span><code>rvzr<span class="w"> </span>reproduce<span class="w"> </span>-s<span class="w"> </span>base.json<span class="w"> </span>-c<span class="w"> </span>./violation-&lt;timestamp&gt;/reproduce.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-t<span class="w"> </span>commented.asm<span class="w"> </span>-i<span class="w"> </span>./inputs/min_input*.bin
</code></pre></div></p>
<h2 id="step-5-insert-speculation-fences">Step 5: Insert Speculation Fences</h2>
<p>To isolate speculative behavior, add fences:
<div class="highlight"><pre><span></span><code>rvzr<span class="w"> </span>minimize<span class="w"> </span>-s<span class="w"> </span>base.json<span class="w"> </span>-c<span class="w"> </span>./violation-&lt;timestamp&gt;/minimize.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-t<span class="w"> </span>commented.asm<span class="w"> </span>-o<span class="w"> </span>fenced.asm<span class="w"> </span>-i<span class="w"> </span>&lt;num_inputs&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--enable-fence-pass<span class="w"> </span><span class="m">1</span>
</code></pre></div></p>
<p>This pass with attempt to insert an <code>LFENCE</code> after every instruction in the program and check if the violation still occurs.</p>
<p>In the resulting file (<code>fenced.asm</code>) the region <em>without</em> fences is the one that causes the violation. The remaining instructions are just setting up the data for the violation, and are likely irrelevant.</p>
<blockquote>
<p>TIP: If an <code>LFENCE</code> is inserted after <em>every</em> instruction in the test case and the violation still occurs, this is most likely due to a bug in the model or the executor. If you are using a custom model, consider checking the model for correctness. If you haven't made changes to the Revizor source code, please, open an issue in the <a href="https://github.com/microsoft/sca-fuzzer/issues">bug tracker</a>.</p>
</blockquote>
<hr />
<h2 id="step-6-map-hardware-traces-to-minimized-program-and-data">Step 6: Map Hardware Traces to Minimized Program and Data</h2>
<p>When both program and its inputs are minimized, you should be able to identify which instructions caused the cache accesses in the hardware traces and which data was leaked.</p>
<p>When we run the <code>reproduce</code> command with the minimized program and inputs, we will see the following hardware traces:</p>
<div class="highlight"><pre><span></span><code>================================ Violations detected ==========================
Contract trace:
 2362171776002334258 (hash)
Hardware traces:
  Input group 1: [1]
  Input group 2: [11]
  ^...............................................^............... [420    | 0     ]
  ^............................................................... [80     | 0     ]
  ^..............^................................................ [0      | 500   ]
</code></pre></div>
<blockquote>
<p>TIP: If in your case the input IDs have changed after minimization, you can either exclude some of the inputs from the arguments of the <code>reproduce</code> command, or re-run the minimizer with fewer passes.</p>
</blockquote>
<p>We see that the hardware traces have been significantly simplified compared to the original violation, and now there are at most two accessed cache sets in each trace: 0 and 48 for input #1, and 0 and 15 for input #11. This is a good sign: the minimization was successful.</p>
<p>We can also tell that the only difference between the two traces is the accessed cache set 48 vs 15 . This is the cache set that is causing the violation, and we should be aiming to find the instruction that does the access.</p>
<p>To do so, let's look at the contents of the <code>commented.asm</code> file. This file contains the minimized program with comments that show which memory addresses or cache lines are accessed by each instruction.</p>
<div class="highlight"><pre><span></span><code>; ... skipped header ...
1.  and rax, 0b1111111111111 # instrumentation
2.  lfence
3.  mov edx, dword ptr [r14 + rax]
4.  # mem access: [1] 0x0 cl 0:0 | [11] 0x0 cl 0:0
5.  or cx, 0b1000 # instrumentation
6.  and cl, 0b11111000 # instrumentation
7.  and dx, 0b11 #
8.  and rsi, 0b1111111111111 #
9.  add cl, 39 #
10. mov rbx, 0b1111111111111 #
11. bt si, dx
12. jbe .bb_0.1
13. jmp .exit_0
14. .bb_0.1:
15. mov ecx, edi
16. and rcx, 0b1111111111000 # instrumentation
17. mov byte ptr [r14 + rcx], 88
; ... skipped footer ...
</code></pre></div>
<blockquote>
<p>TIP: You can find the same information in a different format if you enable <code>dbg_violation</code> in the configuration file and run the <code>reproduce</code> command.</p>
</blockquote>
<p>This program contains only two memory accesses, at lines 3 and 17.</p>
<p>The annotation at line 4 tells us that the <code>mov</code> instruction accesses memory offset <code>0x0</code> when executed with input 1 (<code>[1]</code>) and the same cache set when executed with input 11 (<code>[11]</code>). The notation <code>0:0</code> stands for cache set <code>0</code> and cache line offset <code>0</code>.</p>
<p>This information lets us map this instruction to the first access in the hardware trace:</p>
<div class="highlight"><pre><span></span><code>    ^...............................................^...............
    |
  This eviction maps to `mov edx, dword ptr [r14 + rax]` at line 3
</code></pre></div>
<p>The second memory access (line 17) does not have an annotation, which implies that the contract model has not executed this instruction with the inputs provided. It does not, however, mean that the CPU has not executed this instruction, as there is a chance that this instruction was executed speculatively. This is a typical scenario in violations detected by Revizor.</p>
<p>If we look at the instructions prior to the memory access, we can see <code>jbe</code> instruction at line 12, which is a conditional jump - a common source of speculation, namely branch prediction. This type of speculation is not permitted by the target contract (CT-SEQ), so it could cause a violation. From this, we can make a hypothesis that the memory access at line 17 is speculative and is the one causing the second cache access:</p>
<div class="highlight"><pre><span></span><code> Inputs [1]:
              Hypothesis: This eviction maps to `mov` at line 17
                                                  |
  ^...............................................^...............

 Inputs [11]:
  ^..............^................................................
                 |
           Hypothesis: This eviction maps to `mov` at line 17
</code></pre></div>
<p>To check if our hypothesis is correct, let's cross-reference this information with the leaked bytes from the differential input minimizer:</p>
<div class="highlight"><pre><span></span><code>; .. skip zero bytes
0x00002000 .....^..
0x00002040 ........ ........ ........ ........
  &gt; Result: Leaked 1 bytes
  &gt; Addresses: [&#39;0x2028&#39;]
</code></pre></div>
<p>This summary tells us that <code>rdi</code> has a differing value between inputs #1 and 11. At the same time, the first time <code>rdi</code> is used in the program is at line 15, where it is moved to <code>rcx</code>, and then later used as a part of the address in the memory access at line 17. This would make the speculative memory access at line 17 access different addresses with the two inputs, and would explain the difference between the hardware traces.</p>
<p>At this point, the hypothesis is more-or-less confirmed, and we can declare that the root cause of the leak was the misprediction of the <code>jbe</code> branch at line 12, which caused the speculative execution of the memory access at line 17, and which in turn leaked the value of <code>rdi</code>.</p>
<p>If we want to further increase our confidence, we can manually inspect the contents of the inputs at the address <code>0x2028</code> to see if the values correspond to the cache set ID that we observe in the hardware traces. This can be done by running the <code>hexdump</code> command on the input files:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>hexdump<span class="w"> </span>-C<span class="w"> </span>./inputs/min_input_0001.bin<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">2020</span>
<span class="m">00002020</span><span class="w">  </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w">  </span>1e<span class="w"> </span>1c<span class="w"> </span>4a<span class="w"> </span><span class="m">00</span><span class="w"> </span>1e<span class="w"> </span>1c<span class="w"> </span>4a<span class="w"> </span><span class="m">00</span><span class="w">  </span><span class="p">|</span>..........J...J.<span class="p">|</span>
$<span class="w"> </span>hexdump<span class="w"> </span>-C<span class="w"> </span>./inputs/min_input_0011.bin<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">2020</span>
<span class="m">00002020</span><span class="w">  </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w">  </span>c8<span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">58</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>c8<span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">58</span><span class="w"> </span><span class="m">00</span><span class="w">  </span><span class="p">|</span>..........X...X.<span class="p">|</span>
</code></pre></div>
<p>The values are <code>0x4a1c1e004a1c1e</code> for input #1 and <code>0x5813c8005813c8</code> for input #11. These are masked with <code>0b1111111111000</code> by <code>and</code> at line 16 and become <code>7192</code> and <code>5064</code> respectively. If we translate these values to cache set IDs (<code>id = (addr % 0x1000) // 64</code>), we get <code>48</code> and <code>15</code>. These values match the cache set IDs that we observed in the hardware traces, which confirms our hypothesis.</p>
<p>If we want even more confidence, we can manually modify the input files (e.g, with <code>hexedit</code> tool) to see if the hardware traces change when we modify the value of <code>rdi</code> in the input files.</p>
<hr />
<h2 id="step-7-modify-the-program">Step 7: Modify the Program</h2>
<p>In many cases, the minimization process will not provide a clear result as in the example above and you will not be able to make a specific hypothesis about the root cause of the violation. In such cases, you can try to modify the program in various ways to see if the violation still occurs. There are no strict rules on which modifications to make and you will have to rely on your intuition and knowledge of the target microarchitecture, but here are some general guidelines:</p>
<ol>
<li><strong>Simplify Instructions</strong>: Start by trying to manually replace instructions in <code>minimized.asm</code> with simpler ones. For example, replace complex instructions with memory operands with simple loads or stores.</li>
<li><strong>Increase/Decrease Aliasing</strong>: Try to change the addresses of memory accesses to match (or not match if they already do) the addresses of other instruction. Such aliasing often triggers speculation (e.g., in Speculative Store Bypass or MDS attacks).</li>
<li><strong>Add/Remove Dependent Instructions</strong>: If you have a hypothesis about which instruction triggers speculation, try adding or removing data-dependent instructions before it. This will change the size of the speculative window and might change hardware traces, which will give you more insight into the violation.</li>
<li><strong>Change Memory Permissions</strong>: If the violation is related to memory accesses, try changing the permissions of the memory regions that are accessed by the program. For example, if the memory is read-only, try changing it to read-write. If the violation disappears, it might indicate that the violation is related to the permission checks in the CPU.</li>
<li><strong>Change Instruction Operands</strong>: Try changing operands to add or remove data dependencies between instructions. For example, if you have a sequence of two moves <code>mov rax, [rax]; mov rbx, [rax]</code>, try changing the second move to <code>mov rbx, [rbx]</code> to see if the violation still occurs if there are no data dependencies between the instructions.</li>
</ol>
<p>After each modification, run the <code>reproduce</code> command to see if the violation still occurs:</p>
<div class="highlight"><pre><span></span><code>rvzr<span class="w"> </span>reproduce<span class="w"> </span>-s<span class="w"> </span>base.json<span class="w"> </span>-c<span class="w"> </span>./violation-&lt;timestamp&gt;/reproduce.yaml<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-t<span class="w"> </span>modified.asm<span class="w"> </span>-i<span class="w"> </span>./inputs/min_input*.bin
</code></pre></div>
<blockquote>
<p>NOTE: If you find any other strategies that work well, please consider sharing them by opening a pull request to this documentation. We would love to hear about your experiences and learn from them.</p>
</blockquote>
<hr />
<h2 id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="https://microsoft.github.io/sca-fuzzer/user/cli/">Command Line Interface</a></li>
<li><a href="https://microsoft.github.io/sca-fuzzer/user/minimization/">Minimization Passes</a></li>
<li><a href="https://microsoft.github.io/sca-fuzzer/user/config/">Configuration File Documentation</a></li>
<li><a href="https://microsoft.github.io/sca-fuzzer/user/sandbox/">Sandbox Memory Layout</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Microsoft
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "search.share"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>